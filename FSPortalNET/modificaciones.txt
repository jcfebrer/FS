

Para actualizar la aplicación a la versión 2.6, son necesarias las siguientes acciones en la base de datos:


Si es más antigua que la 2.0 (ejemplo bysportfutbol7):
------------------------------------------------------

- Añadir campo "version" a la tabla configuración. nvarchar(10). Con el contenido 2.6
- Añadir campo "estadisticas" a la tabla configuración. bool -> false
- "cachearCabecera" -> true
- "cachearPie" -> true
- "cachearColumnaIzquierda" -> true
- "cachearColumnaDerecha" -> true
- "cachearColumnaCentro" -> true
- añadir "piePagina" ntext
- añadir "cabPagina" ntext
- añadir "plantillaCorreo" ntext
- añadir "paginaRegistro" nvarchar(255)
- añadir "paginaPerfil" nvarchar(255)
- añadir "paginaLogin" nvarchar(255)
- añadir "paginaRecordar" nvarchar(255)
- añadir "laCaixaNroComercio" nvarchar(50)
- añadir "laCaixaClaveEnc" nvarchar(50)
- añadir "laCaixaTerminal" nvarchar(50)
- añadir "laCaixaURLTpvVirtual" nvarchar(255)
- añadir "mostrarTitulosPaginas" bool
- añadir "mostrarAnadirFavoritos" bool
- añadir "mostrarOpcionesPagina" bool

- añadir la página "errorPages/error500.aspx" a la tabla "paginas"
- añadir la página "formularios/enviarformulario.aspx" a la tabla "paginas"

- añadir el campo "comentarios" (bool) a la tabla "paginas"
- añadir el campo "teclaDeAcceso" (nvarchar(10)) a la tabla "paginas"

- Cambiar admin/te -> admin/editor y quitar _te
- importar tabla "relaciones"

----------------------------

- Cambiar el campo "version" de la tabla configuración a "2.6"
- Añadir el campo "IP" a la tabla usuarios (Texto 25)


- Cambiar el nombre de la página 500-100.asxp a error500.aspx de la tabla páginas
- Añadir campo TAGS en la tabla paginas. Texto de 255 carácteres.
- Añadir campo idCategoria en la tabla paginas. Numero.
- Añadir tabla Categorias_Paginas (importar de Bizkaidenda)
- Establecer relación Paginas.idCategoria -> Categorias_Paginas.idCategoriaPagina (sin integridad)

- Debe existir la tabla 'correo'. Ahora se guardan los correos que envia el sistema en dicha tabla. (borrar las pruebas)

- Activar customErrors en el web.config
	        <customErrors mode="On">
			<error statusCode="403" redirect="errorPages/error500.aspx"/>
			<error statusCode="400" redirect="errorPages/error500.aspx"/>
			<error statusCode="404" redirect="errorPages/error500.aspx"/>
			<error statusCode="500" redirect="errorPages/error500.aspx"/>
		</customErrors>

- añadir en web.config AppSettings -> <add key="dateFormat" value="ddmmyyyy"/>
- añadir en web.config AppSettings -> 
	<!-- configuración de correo para envio de errores desde Global.asax -->
    <add key="DebugFromEmail" value="info@febrersoftware.com"/>
    <add key="DebugToEmail" value="juancarlos@febrersoftware.com"/>
    <add key="DebugServer" value="10.0.0.161"/>
    <add key="DebugUser" value="info@febrersoftware.com"/>
    <add key="DebugPassword" value="rerbef2000"/>


======================================================
Actualización a la 2.7
======================================================

- Cambiar el campo "versión de la tabla configuración a "2.7"
- Cambiar el campo "DirectorioWeb" de "/nombre_portal/" a "/fsportalnet/sitios/nombre_portal/"

	Para cambiar este campo en la tabla páginas, utilizar la sentencia:
	UPDATE Paginas SET contenido = replace(contenido,"/nombre_portal/", "{directorioWeb}");
	UPDATE paginas set contenido = replace(contenido,'/fsportalnet/', '{directorioPortal}');

- Cambiar el campo "uploadPath", y "explorerPath" a /fsportalnet/sitios/nombre_portal/

- Añadir nuevos campos en "configuracion", plantilla(T20), plantillaModulos(T20), y poner contenido. Importar "Plantilla" de la base de datos de "Default".

- Las paginas de administración /admin, deben tener la plantilla ADMIN.

- Añadir campo: jqueryTema en "configuración". Valor por defecto 'base'.

- Añadir campo: plantillaCorreo Texto20 en "configuracion" con el valor "CORREO".
- Añadir campo: plantillaModulos Texto20 en "configuracion" con el valor "MODULO".

- Crear relaciones de "Plantilla", "plantillaCorreo", "plantillaModulos", con plantillas.

- Quitar campo 'precioAmostrar' de 'configuracion', y ponerlo en 'usuarios'. Texto 10.

- Añadir campo 'idioma' en 'usuarios'. Texto 25.

- Cambiar nombre al campo "Group_ID" a "grupo" (Numero).

- Añadir nueva tabla "Grupos". Modificar los usuarios con grupo 4 a 2. Crear relación con "grupo" de la tabla usuarios.

- Añadir en web.config: 
	<!-- versión del código -->
    	<add key="version" value="2.7"/>

- Cambiar urlrewrites del web config al raiz.

- Eliminar campos de la tabla "configuración":
	- uploadComponent, webAncho, webAlto, alineacion, idSkin, porColumnaDer, porColumnaIzq, porColumnaCentral, espacioTabla, webFontSize, cabPagina, piePagina, sinTABLAS, sinCabecera,sinPie,sinColumnaDer,sinColumnaIzq
	
- Añadir campo "plantilla (T20)" y "tags (T255)" a la tabla "paginas"

- Añadir estilo "busy" en estilofp.css ->
	#busy { position: absolute; top: 7px; right: 7px; border: 1px ridge #ccc; background-color: #e95555; color: #eee; padding: 3px; display:none }

- Eliminar tabla "Apariencia".
- Eliminar campos idSkin y estilo de la tabla "modulos", "paginas" y "configuracion"

- Eliminar campos: sinCabecera,sinPie,sinColumnaDer,sinColumnaIzq,scroll,altoPagina,ContenidoCAB, ContenidoPie de "paginas".

- Eliminar ContenidoPie y ContenidoCab de "modulos" y "formularios".

- Modificar el correo de bienvenida incluyendo la activación del perfíl.
- Modificar web.config para que apunte a FSPortal.HttpCompressionModule en vez de FSPortal.clsHttpCompressionModule y FSPortal.URLRewriter en vez de FSPortal.clsURLRewriter

- Cambiar bd para utilizar { } en vez de %.
- Para cambiar los datos, utilizar: 
	En 'Titulo':
	update paginas set titulo = replace(titulo,')%', ')}');
	update paginas set titulo = replace(titulo,'%', '{');
	En 'Contenido':
	update paginas set contenido = replace(contenido,')%', ')}');
	update paginas set contenido = replace(contenido,'%', '{');
	
	Ajustes en 'Contenido':
	update paginas set contenido = replace(contenido,'{"', '%"');
	update paginas set contenido = replace(contenido,'{directorioPortal{', '{directorioPortal}');
	update paginas set contenido = replace(contenido,'{directorioWeb{', '{directorioWeb}');
	update paginas set contenido = replace(contenido,'{webhttp{', '{webhttp}');
	update paginas set contenido = replace(contenido,'{paginaConectar{', '{paginaConectar}');
	update paginas set contenido = replace(contenido,'{correoBienvenida%', '{correoBienvenida}');
	update paginas set contenido = replace(contenido,'{correoInfo{', '{correoInfo}');
	update paginas set contenido = replace(contenido,'{nombreWeb{', '{nombreWeb}');
	update paginas set contenido = replace(contenido,'{usuarioregistrado{', '{usuarioRegistrado}');
	update paginas set contenido = replace(contenido,'{usuarioPassword{', '{usuarioPassword}');
	update paginas set contenido = replace(contenido,'{cs{', '{cs}');
	update paginas set contenido = replace(contenido,'{titulobarra{', '{titulobarra}');
	update paginas set contenido = replace(contenido,'{nombreDia{', '{nombreDia}');
	update paginas set contenido = replace(contenido,'{fecha{', '{fecha}');
	update paginas set contenido = replace(contenido,'{usuarioid{', '{usuarioid}');
	update paginas set contenido = replace(contenido,'{frmPaginaActual{', '{frmPaginaActual}');
	update paginas set contenido = replace(contenido,'{frmPaginas{', '{frmPaginas}');
	
	update paginas set contenido = replace(contenido,'/fsfebrer/', '{directorioWeb}');
	
	Ajustes en 'Titulo':
	update paginas set titulo = replace(titulo,'{nombreweb{', '{nombreweb}');

	
	
- Cambiar el campo titulo de la tabla modulos

	update modulos set titulo = replace(castellano,')%', ')}');
	update modulos set titulo = replace(titulo,'%', '{');
	update modulos set titulo = replace(titulo,'{"', '%"');

- Banners

	update banners set imagen = replace(imagen,'%directorioWeb%', '{directorioWeb}');

- idiomas

	update idiomas set castellano = replace(castellano,')%', ')}');
	update idiomas set castellano = replace(castellano,'%', '{');
	update idiomas set castellano = replace(castellano,'{"', '%"');



======================================================
Actualización a la 2.8
======================================================

- Añadir campo 'contenidoMovil' a la tabla 'plantillas'.

======================================================
Actualización a la 2.9
======================================================

- Añadir campo 'contenidoMovil' a la tabla 'paginas'.
- Añadir campo 'checkURL' a la taba 'paginas'.